function invaildeConfig(t){var e=new Error(t);return e.name="invaildeConfig",e}function getWindow(t){var e=window;if(t)try{for(;e!==e.top;)e.parent.location.href,e=e.parent}catch(t){}return e}function getRef(t,e,i){if(i&&void 0!==i&&""!==i)return encodeURIComponent(i);for(var o=t.document.getElementsByTagName("link"),n=t.location.href,r=null,s=0;s<o.length;s++)if("canonical"===o[s].rel){r=o[s].href;break}return e?"about:blank":encodeURIComponent(r||n)}function bindf8ToWindow(t,e){e.__f8||(e.__f8={}),e.__f8[t]||(e.__f8[t]={}),e.__f8[t].setUndefinedProperty=function(i,o){if(e.__f8[t][i])return e.__f8[t][i];if(o)return"function"==typeof o?(e.__f8[t][i]=o(),e.__f8[t][i]):(e.__f8[t][i]=o,o);throw new Error("Trying to access f8 v"+t+" property "+i+", but its not defined")}}function injectScriptFactory(t){var e=document.createElement("script");e.type="text/javascript",e.src=t,e.async="async",document.body.appendChild(e)}function vaildateConfig(t){if(void 0===t&&(t={}),void 0===t.instID||""===t.instID)throw invaildeConfig('Missing "instID" in config');return void 0!==t.endpoint&&""!==t.endpoint||(t.endpoint="https://fresh8.co/"+t.instID+"/raw"),void 0===t.inApp&&(t.inApp=!1),void 0===t.shouldBreakOut&&(t.shouldBreakOut=!1),void 0===t.listenOnPushState&&(t.listenOnPushState=!1),t}function requestAdData(t){var e=vaildateRequestAdConf(t),i=constructRequestURL(e.endpoint,{slot:e.slotID,view:e.view,clickUrl:e.clickTrackingRedirect,sport:e.sport,match:e.match,competitorIds:e.competitorIDs,competitors:e.competitors,competitionIds:e.competitionIDs,competitions:e.competitions,linkSameWindow:e.linkSameWindow,brand:e.brand,ref:getRef(e.window,e.inApp,e.url)});return fetch(i,{credentials:"include"}).then(checkStatusCode).then(parseJSON)}function checkStatusCode(t){return t.status>=200&&t.status<300?t:Promise.reject("Server returned error: "+t.status)}function parseJSON(t){if(t)return t.json()}function constructRequestURL(t,e){void 0===e&&(e={});var i=Object.assign({},e);return void 0!==i.competitorIds&&(i.competitorIds=i.competitorIds.map(function(t){return encodeURIComponent(t)})),void 0!==i.competitors&&(i.competitors=i.competitors.map(function(t){return encodeURIComponent(t)})),void 0!==i.competitionIds&&(i.competitionIds=i.competitionIds.map(function(t){return encodeURIComponent(t)})),void 0!==i.competitions&&(i.competitions=i.competitions.map(function(t){return encodeURIComponent(t)})),t+buildQueryString(i)}function vaildateRequestAdConf(t){if(void 0===t&&(t={}),void 0===t.endpoint||""===t.endpoint)throw invaildeConfig('Missing "endpoint"');if(void 0===t.slotID||""===t.slotID)throw invaildeConfig('Missing "slotID"');if(void 0===t.window||""===t.window)throw invaildeConfig('Missing "window"');if(void 0===t.inApp&&(t.inApp=!1),void 0===t.shouldBreakOut&&(t.shouldBreakOut=!1),void 0===t.linkSameWindow&&(t.linkSameWindow=!1),void 0===t.competitorIDs&&(t.competitorIDs=[]),void 0===t.competitors&&(t.competitors=[]),void 0===t.competitionIDs&&(t.competitionIDs=[]),void 0===t.competitions&&(t.competitions=[]),void 0===t.listenOnPushState&&(t.listenOnPushState=!1),(0!==t.competitors.length||0!==t.competitions.length)&&!t.sport)throw invaildeConfig('Sport is required if "competitions" or "competitors" is passed through in the config');return t}function buildQueryString(t){var e="?";return Object.keys(t).forEach(function(i){var o=t[i];o&&""!==o&&0!==o.length&&("[object Array]"===Object.prototype.toString.call(o)?e+=i+"="+o.join(",")+"&":e+=i+"="+o+"&")}),e}!function(t){if(!t.fetch){var e={searchParams:"URLSearchParams"in t,iterable:"Symbol"in t&&"iterator"in Symbol,blob:"FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),formData:"FormData"in t,arrayBuffer:"ArrayBuffer"in t};if(e.arrayBuffer)var i=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],o=function(t){return t&&DataView.prototype.isPrototypeOf(t)},n=ArrayBuffer.isView||function(t){return t&&i.indexOf(Object.prototype.toString.call(t))>-1};h.prototype.append=function(t,e){t=a(t),e=c(e);var i=this.map[t];i||(i=[],this.map[t]=i),i.push(e)},h.prototype.delete=function(t){delete this.map[a(t)]},h.prototype.get=function(t){var e=this.map[a(t)];return e?e[0]:null},h.prototype.getAll=function(t){return this.map[a(t)]||[]},h.prototype.has=function(t){return this.map.hasOwnProperty(a(t))},h.prototype.set=function(t,e){this.map[a(t)]=[c(e)]},h.prototype.forEach=function(t,e){Object.getOwnPropertyNames(this.map).forEach(function(i){this.map[i].forEach(function(o){t.call(e,o,i,this)},this)},this)},h.prototype.keys=function(){var t=[];return this.forEach(function(e,i){t.push(i)}),d(t)},h.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),d(t)},h.prototype.entries=function(){var t=[];return this.forEach(function(e,i){t.push([i,e])}),d(t)},e.iterable&&(h.prototype[Symbol.iterator]=h.prototype.entries);var r=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];y.prototype.clone=function(){return new y(this,{body:this._bodyInit})},v.call(y.prototype),v.call(w.prototype),w.prototype.clone=function(){return new w(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new h(this.headers),url:this.url})},w.error=function(){var t=new w(null,{status:0,statusText:""});return t.type="error",t};var s=[301,302,303,307,308];w.redirect=function(t,e){if(-1===s.indexOf(e))throw new RangeError("Invalid status code");return new w(null,{status:e,headers:{location:t}})},t.Headers=h,t.Request=y,t.Response=w,t.fetch=function(t,i){return new Promise(function(o,n){var r=new y(t,i),s=new XMLHttpRequest;s.onload=function(){var t,e,i={status:s.status,statusText:s.statusText,headers:(t=s.getAllResponseHeaders()||"",e=new h,t.split("\r\n").forEach(function(t){var i=t.split(":"),o=i.shift().trim();if(o){var n=i.join(":").trim();e.append(o,n)}}),e)};i.url="responseURL"in s?s.responseURL:i.headers.get("X-Request-URL");var n="response"in s?s.response:s.responseText;o(new w(n,i))},s.onerror=function(){n(new TypeError("Network request failed"))},s.ontimeout=function(){n(new TypeError("Network request failed"))},s.open(r.method,r.url,!0),"include"===r.credentials&&(s.withCredentials=!0),"responseType"in s&&e.blob&&(s.responseType="blob"),r.headers.forEach(function(t,e){s.setRequestHeader(e,t)}),s.send(void 0===r._bodyInit?null:r._bodyInit)})},t.fetch.polyfill=!0}function a(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function c(t){return"string"!=typeof t&&(t=String(t)),t}function d(t){var i={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return e.iterable&&(i[Symbol.iterator]=function(){return i}),i}function h(t){this.map={},t instanceof h?t.forEach(function(t,e){this.append(e,t)},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}function f(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function u(t){return new Promise(function(e,i){t.onload=function(){e(t.result)},t.onerror=function(){i(t.error)}})}function p(t){var e=new FileReader,i=u(e);return e.readAsArrayBuffer(t),i}function l(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function v(){return this.bodyUsed=!1,this._initBody=function(t){if(this._bodyInit=t,t)if("string"==typeof t)this._bodyText=t;else if(e.blob&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t;else if(e.formData&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(e.searchParams&&URLSearchParams.prototype.isPrototypeOf(t))this._bodyText=t.toString();else if(e.arrayBuffer&&e.blob&&o(t))this._bodyArrayBuffer=l(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!e.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(t)&&!n(t))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=l(t)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):e.searchParams&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},e.blob&&(this.blob=function(){var t=f(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?f(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(p)}),this.text=function(){var t,e,i,o=f(this);if(o)return o;if(this._bodyBlob)return t=this._bodyBlob,e=new FileReader,i=u(e),e.readAsText(t),i;if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),i=new Array(e.length),o=0;o<e.length;o++)i[o]=String.fromCharCode(e[o]);return i.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},e.formData&&(this.formData=function(){return this.text().then(m)}),this.json=function(){return this.text().then(JSON.parse)},this}function y(t,e){var i,o,n=(e=e||{}).body;if("string"==typeof t)this.url=t;else{if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new h(t.headers)),this.method=t.method,this.mode=t.mode,n||null==t._bodyInit||(n=t._bodyInit,t.bodyUsed=!0)}if(this.credentials=e.credentials||this.credentials||"omit",!e.headers&&this.headers||(this.headers=new h(e.headers)),this.method=(i=e.method||this.method||"GET",o=i.toUpperCase(),r.indexOf(o)>-1?o:i),this.mode=e.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&n)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(n)}function m(t){var e=new FormData;return t.trim().split("&").forEach(function(t){if(t){var i=t.split("="),o=i.shift().replace(/\+/g," "),n=i.join("=").replace(/\+/g," ");e.append(decodeURIComponent(o),decodeURIComponent(n))}}),e}function w(t,e){e||(e={}),this.type="default",this.status="status"in e?e.status:200,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new h(e.headers),this.url=e.url||"",this._initBody(t)}}("undefined"!=typeof self?self:window);var Ad=function(t){void 0===t&&(t={}),this.active=!1,this.awaitingFactory=!0,this.selector=null,this.creativeRef=null,this.creativePath=null,this.CSSPath=null,this.data=null,this.env=null,this.loadResolvers=null,this.adInstance=null,this.config=vaildateConfig$1(t),this.creativeFactoryCache=t.creativeFactoryCache,this.window=t.window,this.evo=!1};function vaildateConfig$1(t){if(void 0===t&&(t={}),void 0===t.endpoint||""===t.endpoint)throw invaildeConfig('Missing "endpoint"');if(void 0===t.creativeFactoryCache||""===t.creativeFactoryCache)throw invaildeConfig('Missing "creativeFactoryCache"');if(void 0===t.slotID||""===t.slotID)throw invaildeConfig('Missing "slotID"');if(void 0===t.appendPoint||""===t.appendPoint)throw invaildeConfig('Missing "appendPoint"');if(void 0===t.window||""===t.window)throw invaildeConfig('Missing "window"');if(void 0===t.inApp&&(t.inApp=!1),void 0===t.shouldBreakOut&&(t.shouldBreakOut=!1),void 0===t.linkSameWindow&&(t.linkSameWindow=!1),void 0===t.competitorIDs&&(t.competitorIDs=[]),void 0===t.competitors&&(t.competitors=[]),void 0===t.competitionIDs&&(t.competitionIDs=[]),void 0===t.competitions&&(t.competitions=[]),void 0===t.listenOnPushState&&(t.listenOnPushState=!1),(0!==t.competitors.length||0!==t.competitions.length)&&!t.sport)throw invaildeConfig('Sport is required if "competitions" or "competitors" is passed through in the config');return t}Ad.prototype.load=function(){var t=this;return new Promise(function(e,i){requestAdData({slotID:t.config.slotID,view:t.config.view,clickTrackingRedirect:t.config.clickTrackingRedirect,sport:t.config.sport,match:t.config.match,competitorIDs:t.config.competitorIDs,competitors:t.config.competitors,competitionIDs:t.config.competitionIDs,competitions:t.config.competitions,window:t.config.window,inApp:t.config.inApp,endpoint:t.config.endpoint,appendPoint:t.config.appendPoint,linkSameWindow:t.config.linkSameWindow,url:t.config.url,brand:t.config.brand}).then(function(o){var n={resolve:e,reject:i};t.loadResolvers=n,o.env?o.env&&(t.evo=!0,Object.keys(o.products).forEach(function(e){t.creativeRef=o.products[e].config,t.CSSPath=o.products[e].skin,t.data=o.products[e].instances[0],t.env=o.env,t.creativePath=o.env.cdn+"/"+o.products[e].config+".js?v="+o.env.version,t.data.appendPoint=t.config.appendPoint})):Object.keys(o).forEach(function(e){t.creativeRef=e,t.CSSPath=o[e].CSSPath,t.data=o[e].instances[0].data,t.env=o[e].instances[0].env,t.creativePath=o[e].creativePath,t.data.appendPoint=t.config.appendPoint}),t.env.adhesion?t.selector="#f8-adhesion":t.selector=t.config.appendPoint+" .f8"+t.creativeRef,t.awaitingFactory?injectScriptFactory(t.creativePath):t._callCreativeFactory()}).catch(function(e){t.active=!1,i(e)})})},Ad.prototype.reload=function(){var t=this;return new Promise(function(e,i){requestAdData({slotID:t.config.slotID,view:t.config.view,clickTrackingRedirect:t.config.clickTrackingRedirect,sport:t.config.sport,match:t.config.match,competitorIDs:t.config.competitorIDs,competitors:t.config.competitors,competitionIDs:t.config.competitionIDs,competitions:t.config.competitions,window:t.config.window,inApp:t.config.inApp,endpoint:t.config.endpoint,appendPoint:t.config.appendPoint,linkSameWindow:t.config.linkSameWindow,url:t.config.url,brand:t.config.brand}).then(function(o){var n=Object.keys(o)[0],r={resolve:e,reject:i};return t.loadResolvers=r,t.destroy(),n!==t.creativeRef&&(t.creativeRef=n,t.creativePath=o[n].creativePath,t._switchAdType()),t.data=o[t.creativeRef].instances[0].data,t.env=o[t.creativeRef].instances[0].env,t.CSSPath=o[t.creativeRef].CSSPath,t.data.appendPoint=t.config.appendPoint,t.selector=t.config.appendPoint+" .f8"+t.creativeRef,t._callCreativeFactory()}).catch(i)})},Ad.prototype.destroy=function(){if(this.active){var t=document.querySelector(this.selector);this.adInstance.destroy(),t.parentNode.removeChild(t),this.active=!1}},Ad.prototype._switchAdType=function(){this.creativeFactoryCache.exists(this.creativeRef)?this._setCreativeFactory(this.creativeFactoryCache.get(this.creativeRef)):(this.awaitingFactory=!0,injectScriptFactory(this.creativePath))},Ad.prototype._setCreativeFactory=function(t){this.awaitingFactory=!1,this.creativeFactory=t},Ad.prototype._callCreativeFactory=function(){var t=this;return this.awaitingFactory?Promise.resolve():this.creativeFactory(this.env,this.data,this.CSSPath,this.window).then(function(e){t.adInstance=e,t.active=!0,t.loadResolvers.resolve(t)}).catch(this.loadResolvers.reject)};var Cache=function(){this.cache={}};function customEvent(){if("function"==typeof window.CustomEvent)return!1;function t(t,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var i=document.createEvent("CustomEvent");return i.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),i}t.prototype=window.Event.prototype,window.CustomEvent=t}function PolyfillHistoryPushState(){var t=window.history.pushState,e=new CustomEvent("__f8-history-push-state");function i(){var i=t.apply(this,arguments);return window.dispatchEvent(e),i}return{restore:function(){window.history.pushState=t},fill:function(){history.pushState=i}}}Cache.prototype.put=function(t,e){this.cache[t]=e},Cache.prototype.remove=function(t){this.cache[t]&&delete this.cache[t]},Cache.prototype.get=function(t){return this.cache[t]},Cache.prototype.exists=function(t){return!!this.cache[t]};var version="1.0.0",Fresh8=function(t){this.Ad=Ad,customEvent(),this.config=vaildateConfig(t),this.window=getWindow(this.config.shouldBreakOut),this.ads=[],this.creativeFactoryCache=new Cache,bindf8ToWindow(version,this.window),this._addEventLisnters(),this.config.listenOnPushState&&(this.polyfillHistoryPushState=new PolyfillHistoryPushState,this.polyfillHistoryPushState.fill())};Fresh8.prototype.requestAd=function(t){var e=this;return void 0===t&&(t={}),new Promise(function(i){t.endpoint=e.config.endpoint,t.window=e.window,t.creativeFactoryCache=e.creativeFactoryCache;var o=new e.Ad(t);return e.ads.push(o),i(o.load())})},Fresh8.prototype.remove=function(){this._removeEventLisnters(),this.destroyAllAds(),this.config.listenOnPushState&&this.polyfillHistoryPushState.restore()},Fresh8.prototype.reloadAllAds=function(){var t=this.ads.filter(function(t){return t.active});return Promise.all(t.map(function(t){return t.reload()}))},Fresh8.prototype.destroyAllAds=function(){var t=this.ads.filter(function(t){return t.active});return Promise.all(t.map(function(t){return t.destroy()}))},Fresh8.prototype._addEventLisnters=function(){this.boundOnCreativeLoaded=this._onCreativeLoaded.bind(this),this.boundOnHistoryPushStateChange=this._onHistoryPushStateChange.bind(this),this.window.addEventListener("__f8-creative-script-loaded",this.boundOnCreativeLoaded),this.window.addEventListener("__f8-product-script-loaded",this.boundOnCreativeLoaded),this.window.addEventListener("__f8-history-push-state",this.boundOnHistoryPushStateChange)},Fresh8.prototype._removeEventLisnters=function(){this.window.removeEventListener("__f8-creative-script-loaded",this.boundOnCreativeLoaded),this.window.removeEventListener("__f8-product-script-loaded",this.boundOnCreativeLoaded),this.window.removeEventListener("__f8-history-push-state",this.boundOnHistoryPushStateChange)},Fresh8.prototype._onCreativeLoaded=function(t){this.creativeFactoryCache.put(t.creativeRef,t.creativeFactory),this.ads.forEach(function(e){e.evo?e.awaitingFactory&&t.config===e.creativeRef&&(e._setCreativeFactory(t.productFactory),e._callCreativeFactory()):e.awaitingFactory&&t.creativeRef===e.creativeRef&&(e._setCreativeFactory(t.creativeFactory),e._callCreativeFactory())})},Fresh8.prototype._onHistoryPushStateChange=function(){this.reloadAllAds().catch()};export default Fresh8;
//# sourceMappingURL=module.js.map
