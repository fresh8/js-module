{"version":3,"file":"browser.js","sources":["../node_modules/whatwg-fetch/fetch.js","../src/errors.js","../src/util.js","../src/api/index.js","../src/ad/index.js","../src/cache/index.js","../src/polyfill.js","../src/index.js","../src/browser.js"],"sourcesContent":["var support = {\n  searchParams: 'URLSearchParams' in self,\n  iterable: 'Symbol' in self && 'iterator' in Symbol,\n  blob:\n    'FileReader' in self &&\n    'Blob' in self &&\n    (function() {\n      try {\n        new Blob()\n        return true\n      } catch (e) {\n        return false\n      }\n    })(),\n  formData: 'FormData' in self,\n  arrayBuffer: 'ArrayBuffer' in self\n}\n\nfunction isDataView(obj) {\n  return obj && DataView.prototype.isPrototypeOf(obj)\n}\n\nif (support.arrayBuffer) {\n  var viewClasses = [\n    '[object Int8Array]',\n    '[object Uint8Array]',\n    '[object Uint8ClampedArray]',\n    '[object Int16Array]',\n    '[object Uint16Array]',\n    '[object Int32Array]',\n    '[object Uint32Array]',\n    '[object Float32Array]',\n    '[object Float64Array]'\n  ]\n\n  var isArrayBufferView =\n    ArrayBuffer.isView ||\n    function(obj) {\n      return obj && viewClasses.indexOf(Object.prototype.toString.call(obj)) > -1\n    }\n}\n\nfunction normalizeName(name) {\n  if (typeof name !== 'string') {\n    name = String(name)\n  }\n  if (/[^a-z0-9\\-#$%&'*+.^_`|~]/i.test(name)) {\n    throw new TypeError('Invalid character in header field name')\n  }\n  return name.toLowerCase()\n}\n\nfunction normalizeValue(value) {\n  if (typeof value !== 'string') {\n    value = String(value)\n  }\n  return value\n}\n\n// Build a destructive iterator for the value list\nfunction iteratorFor(items) {\n  var iterator = {\n    next: function() {\n      var value = items.shift()\n      return {done: value === undefined, value: value}\n    }\n  }\n\n  if (support.iterable) {\n    iterator[Symbol.iterator] = function() {\n      return iterator\n    }\n  }\n\n  return iterator\n}\n\nexport function Headers(headers) {\n  this.map = {}\n\n  if (headers instanceof Headers) {\n    headers.forEach(function(value, name) {\n      this.append(name, value)\n    }, this)\n  } else if (Array.isArray(headers)) {\n    headers.forEach(function(header) {\n      this.append(header[0], header[1])\n    }, this)\n  } else if (headers) {\n    Object.getOwnPropertyNames(headers).forEach(function(name) {\n      this.append(name, headers[name])\n    }, this)\n  }\n}\n\nHeaders.prototype.append = function(name, value) {\n  name = normalizeName(name)\n  value = normalizeValue(value)\n  var oldValue = this.map[name]\n  this.map[name] = oldValue ? oldValue + ', ' + value : value\n}\n\nHeaders.prototype['delete'] = function(name) {\n  delete this.map[normalizeName(name)]\n}\n\nHeaders.prototype.get = function(name) {\n  name = normalizeName(name)\n  return this.has(name) ? this.map[name] : null\n}\n\nHeaders.prototype.has = function(name) {\n  return this.map.hasOwnProperty(normalizeName(name))\n}\n\nHeaders.prototype.set = function(name, value) {\n  this.map[normalizeName(name)] = normalizeValue(value)\n}\n\nHeaders.prototype.forEach = function(callback, thisArg) {\n  for (var name in this.map) {\n    if (this.map.hasOwnProperty(name)) {\n      callback.call(thisArg, this.map[name], name, this)\n    }\n  }\n}\n\nHeaders.prototype.keys = function() {\n  var items = []\n  this.forEach(function(value, name) {\n    items.push(name)\n  })\n  return iteratorFor(items)\n}\n\nHeaders.prototype.values = function() {\n  var items = []\n  this.forEach(function(value) {\n    items.push(value)\n  })\n  return iteratorFor(items)\n}\n\nHeaders.prototype.entries = function() {\n  var items = []\n  this.forEach(function(value, name) {\n    items.push([name, value])\n  })\n  return iteratorFor(items)\n}\n\nif (support.iterable) {\n  Headers.prototype[Symbol.iterator] = Headers.prototype.entries\n}\n\nfunction consumed(body) {\n  if (body.bodyUsed) {\n    return Promise.reject(new TypeError('Already read'))\n  }\n  body.bodyUsed = true\n}\n\nfunction fileReaderReady(reader) {\n  return new Promise(function(resolve, reject) {\n    reader.onload = function() {\n      resolve(reader.result)\n    }\n    reader.onerror = function() {\n      reject(reader.error)\n    }\n  })\n}\n\nfunction readBlobAsArrayBuffer(blob) {\n  var reader = new FileReader()\n  var promise = fileReaderReady(reader)\n  reader.readAsArrayBuffer(blob)\n  return promise\n}\n\nfunction readBlobAsText(blob) {\n  var reader = new FileReader()\n  var promise = fileReaderReady(reader)\n  reader.readAsText(blob)\n  return promise\n}\n\nfunction readArrayBufferAsText(buf) {\n  var view = new Uint8Array(buf)\n  var chars = new Array(view.length)\n\n  for (var i = 0; i < view.length; i++) {\n    chars[i] = String.fromCharCode(view[i])\n  }\n  return chars.join('')\n}\n\nfunction bufferClone(buf) {\n  if (buf.slice) {\n    return buf.slice(0)\n  } else {\n    var view = new Uint8Array(buf.byteLength)\n    view.set(new Uint8Array(buf))\n    return view.buffer\n  }\n}\n\nfunction Body() {\n  this.bodyUsed = false\n\n  this._initBody = function(body) {\n    this._bodyInit = body\n    if (!body) {\n      this._bodyText = ''\n    } else if (typeof body === 'string') {\n      this._bodyText = body\n    } else if (support.blob && Blob.prototype.isPrototypeOf(body)) {\n      this._bodyBlob = body\n    } else if (support.formData && FormData.prototype.isPrototypeOf(body)) {\n      this._bodyFormData = body\n    } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {\n      this._bodyText = body.toString()\n    } else if (support.arrayBuffer && support.blob && isDataView(body)) {\n      this._bodyArrayBuffer = bufferClone(body.buffer)\n      // IE 10-11 can't handle a DataView body.\n      this._bodyInit = new Blob([this._bodyArrayBuffer])\n    } else if (support.arrayBuffer && (ArrayBuffer.prototype.isPrototypeOf(body) || isArrayBufferView(body))) {\n      this._bodyArrayBuffer = bufferClone(body)\n    } else {\n      this._bodyText = body = Object.prototype.toString.call(body)\n    }\n\n    if (!this.headers.get('content-type')) {\n      if (typeof body === 'string') {\n        this.headers.set('content-type', 'text/plain;charset=UTF-8')\n      } else if (this._bodyBlob && this._bodyBlob.type) {\n        this.headers.set('content-type', this._bodyBlob.type)\n      } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {\n        this.headers.set('content-type', 'application/x-www-form-urlencoded;charset=UTF-8')\n      }\n    }\n  }\n\n  if (support.blob) {\n    this.blob = function() {\n      var rejected = consumed(this)\n      if (rejected) {\n        return rejected\n      }\n\n      if (this._bodyBlob) {\n        return Promise.resolve(this._bodyBlob)\n      } else if (this._bodyArrayBuffer) {\n        return Promise.resolve(new Blob([this._bodyArrayBuffer]))\n      } else if (this._bodyFormData) {\n        throw new Error('could not read FormData body as blob')\n      } else {\n        return Promise.resolve(new Blob([this._bodyText]))\n      }\n    }\n\n    this.arrayBuffer = function() {\n      if (this._bodyArrayBuffer) {\n        return consumed(this) || Promise.resolve(this._bodyArrayBuffer)\n      } else {\n        return this.blob().then(readBlobAsArrayBuffer)\n      }\n    }\n  }\n\n  this.text = function() {\n    var rejected = consumed(this)\n    if (rejected) {\n      return rejected\n    }\n\n    if (this._bodyBlob) {\n      return readBlobAsText(this._bodyBlob)\n    } else if (this._bodyArrayBuffer) {\n      return Promise.resolve(readArrayBufferAsText(this._bodyArrayBuffer))\n    } else if (this._bodyFormData) {\n      throw new Error('could not read FormData body as text')\n    } else {\n      return Promise.resolve(this._bodyText)\n    }\n  }\n\n  if (support.formData) {\n    this.formData = function() {\n      return this.text().then(decode)\n    }\n  }\n\n  this.json = function() {\n    return this.text().then(JSON.parse)\n  }\n\n  return this\n}\n\n// HTTP methods whose capitalization should be normalized\nvar methods = ['DELETE', 'GET', 'HEAD', 'OPTIONS', 'POST', 'PUT']\n\nfunction normalizeMethod(method) {\n  var upcased = method.toUpperCase()\n  return methods.indexOf(upcased) > -1 ? upcased : method\n}\n\nexport function Request(input, options) {\n  options = options || {}\n  var body = options.body\n\n  if (input instanceof Request) {\n    if (input.bodyUsed) {\n      throw new TypeError('Already read')\n    }\n    this.url = input.url\n    this.credentials = input.credentials\n    if (!options.headers) {\n      this.headers = new Headers(input.headers)\n    }\n    this.method = input.method\n    this.mode = input.mode\n    this.signal = input.signal\n    if (!body && input._bodyInit != null) {\n      body = input._bodyInit\n      input.bodyUsed = true\n    }\n  } else {\n    this.url = String(input)\n  }\n\n  this.credentials = options.credentials || this.credentials || 'same-origin'\n  if (options.headers || !this.headers) {\n    this.headers = new Headers(options.headers)\n  }\n  this.method = normalizeMethod(options.method || this.method || 'GET')\n  this.mode = options.mode || this.mode || null\n  this.signal = options.signal || this.signal\n  this.referrer = null\n\n  if ((this.method === 'GET' || this.method === 'HEAD') && body) {\n    throw new TypeError('Body not allowed for GET or HEAD requests')\n  }\n  this._initBody(body)\n}\n\nRequest.prototype.clone = function() {\n  return new Request(this, {body: this._bodyInit})\n}\n\nfunction decode(body) {\n  var form = new FormData()\n  body\n    .trim()\n    .split('&')\n    .forEach(function(bytes) {\n      if (bytes) {\n        var split = bytes.split('=')\n        var name = split.shift().replace(/\\+/g, ' ')\n        var value = split.join('=').replace(/\\+/g, ' ')\n        form.append(decodeURIComponent(name), decodeURIComponent(value))\n      }\n    })\n  return form\n}\n\nfunction parseHeaders(rawHeaders) {\n  var headers = new Headers()\n  // Replace instances of \\r\\n and \\n followed by at least one space or horizontal tab with a space\n  // https://tools.ietf.org/html/rfc7230#section-3.2\n  var preProcessedHeaders = rawHeaders.replace(/\\r?\\n[\\t ]+/g, ' ')\n  preProcessedHeaders.split(/\\r?\\n/).forEach(function(line) {\n    var parts = line.split(':')\n    var key = parts.shift().trim()\n    if (key) {\n      var value = parts.join(':').trim()\n      headers.append(key, value)\n    }\n  })\n  return headers\n}\n\nBody.call(Request.prototype)\n\nexport function Response(bodyInit, options) {\n  if (!options) {\n    options = {}\n  }\n\n  this.type = 'default'\n  this.status = options.status === undefined ? 200 : options.status\n  this.ok = this.status >= 200 && this.status < 300\n  this.statusText = 'statusText' in options ? options.statusText : 'OK'\n  this.headers = new Headers(options.headers)\n  this.url = options.url || ''\n  this._initBody(bodyInit)\n}\n\nBody.call(Response.prototype)\n\nResponse.prototype.clone = function() {\n  return new Response(this._bodyInit, {\n    status: this.status,\n    statusText: this.statusText,\n    headers: new Headers(this.headers),\n    url: this.url\n  })\n}\n\nResponse.error = function() {\n  var response = new Response(null, {status: 0, statusText: ''})\n  response.type = 'error'\n  return response\n}\n\nvar redirectStatuses = [301, 302, 303, 307, 308]\n\nResponse.redirect = function(url, status) {\n  if (redirectStatuses.indexOf(status) === -1) {\n    throw new RangeError('Invalid status code')\n  }\n\n  return new Response(null, {status: status, headers: {location: url}})\n}\n\nexport var DOMException = self.DOMException\ntry {\n  new DOMException()\n} catch (err) {\n  DOMException = function(message, name) {\n    this.message = message\n    this.name = name\n    var error = Error(message)\n    this.stack = error.stack\n  }\n  DOMException.prototype = Object.create(Error.prototype)\n  DOMException.prototype.constructor = DOMException\n}\n\nexport function fetch(input, init) {\n  return new Promise(function(resolve, reject) {\n    var request = new Request(input, init)\n\n    if (request.signal && request.signal.aborted) {\n      return reject(new DOMException('Aborted', 'AbortError'))\n    }\n\n    var xhr = new XMLHttpRequest()\n\n    function abortXhr() {\n      xhr.abort()\n    }\n\n    xhr.onload = function() {\n      var options = {\n        status: xhr.status,\n        statusText: xhr.statusText,\n        headers: parseHeaders(xhr.getAllResponseHeaders() || '')\n      }\n      options.url = 'responseURL' in xhr ? xhr.responseURL : options.headers.get('X-Request-URL')\n      var body = 'response' in xhr ? xhr.response : xhr.responseText\n      resolve(new Response(body, options))\n    }\n\n    xhr.onerror = function() {\n      reject(new TypeError('Network request failed'))\n    }\n\n    xhr.ontimeout = function() {\n      reject(new TypeError('Network request failed'))\n    }\n\n    xhr.onabort = function() {\n      reject(new DOMException('Aborted', 'AbortError'))\n    }\n\n    xhr.open(request.method, request.url, true)\n\n    if (request.credentials === 'include') {\n      xhr.withCredentials = true\n    } else if (request.credentials === 'omit') {\n      xhr.withCredentials = false\n    }\n\n    if ('responseType' in xhr && support.blob) {\n      xhr.responseType = 'blob'\n    }\n\n    request.headers.forEach(function(value, name) {\n      xhr.setRequestHeader(name, value)\n    })\n\n    if (request.signal) {\n      request.signal.addEventListener('abort', abortXhr)\n\n      xhr.onreadystatechange = function() {\n        // DONE (success or failure)\n        if (xhr.readyState === 4) {\n          request.signal.removeEventListener('abort', abortXhr)\n        }\n      }\n    }\n\n    xhr.send(typeof request._bodyInit === 'undefined' ? null : request._bodyInit)\n  })\n}\n\nfetch.polyfill = true\n\nif (!self.fetch) {\n  self.fetch = fetch\n  self.Headers = Headers\n  self.Request = Request\n  self.Response = Response\n}\n","/**\n * Invailde config\n * @param  {String} message is discription you want to add to the error.\n * @return {Error}          a new error with the correct name and message.\n */\nexport function invaildeConfig (message) {\n  const error = new Error(message);\n  error.name = 'invaildeConfig';\n  return error;\n}\n","import { invaildeConfig } from './errors';\n\n/**\n * Returns the window object that this script should inject into\n * @param  {Boolean} shouldBreak is whether or not the script should attempt\n *                               to break from iframe.\n * @return {Window} the working window\n */\nexport function getWindow (shouldBreak) {\n  let workingWindow = window;\n  if (shouldBreak) {\n    try {\n      while (workingWindow !== workingWindow.top) {\n        // The order here is important, as the first line may\n        // throw a security error and break the loop.\n        workingWindow.parent.location.href;\n        workingWindow = workingWindow.parent;\n      }\n    } catch (e) {}\n  }\n  return workingWindow;\n}\n\n/**\n * Search for <link rel=\"canonical\"> elements or fallback to use the page\n * localtion. If a \"userOverrideRef\" is defined than is returned but URL encoded\n * @param  {Object}  window          is the window object you want to get the\n *                                   canonical link tag from.\n * @param  {Boolean} inApp           is used to control if the page ref should\n *                                   be set to \"about:blank\" as it will cause\n *                                   errors to throw if \"window.localtion\" is\n *                                   accessed in some cases.\n * @param  {String}  userOverrideRef is the over the canonical or window\n *                                   localtion is specified.\n * @return {String}  canonical string or page localtion URL encoded\n */\nexport function getRef (window, inApp, userOverrideRef) {\n  if (\n    userOverrideRef &&\n    typeof userOverrideRef !== 'undefined' &&\n    userOverrideRef !== ''\n  ) {\n    return encodeURIComponent(userOverrideRef);\n  }\n\n  const links = window.document.getElementsByTagName('link');\n  const location = window.location.href;\n\n  let canonical = null;\n  let ref = '';\n\n  for (var i = 0; i < links.length; i++) {\n    if (links[i].rel === 'canonical') {\n      canonical = links[i].href;\n      break;\n    }\n  }\n\n  if (inApp) {\n    ref = 'about:blank';\n  } else {\n    ref = encodeURIComponent(canonical || location);\n  }\n\n  return ref;\n}\n\n/**\n * Binds the \"__f8\" object and API to the window\n * @param {String} version      is the version to bind the API under\n * @param {Object} targetWindow is window to bind the \"__f8\" object to\n */\nexport function bindf8ToWindow (version, targetWindow) {\n  if (!targetWindow.__f8) {\n    targetWindow.__f8 = {};\n  }\n\n  if (!targetWindow.__f8[version]) {\n    targetWindow.__f8[version] = {};\n  }\n\n  /**\n   * Check if key exists, returns existing value\n   * or replaces it with val\n   * @param  {String}   key        - Key to access value\n   * @param  {Function|Object} val - any value\n   * @return {Object}              - assigned value for key\n   */\n  targetWindow.__f8[version].setUndefinedProperty = function (key, val) {\n    if (targetWindow.__f8[version][key]) {\n      return targetWindow.__f8[version][key];\n    } else if (val) {\n      if (typeof val === 'function') {\n        targetWindow.__f8[version][key] = val();\n        return targetWindow.__f8[version][key];\n      } else {\n        targetWindow.__f8[version][key] = val;\n        return val;\n      }\n    } else {\n      throw new Error(\n        'Trying to access f8 v' +\n          version +\n          ' property ' +\n          key +\n          ', but its not defined'\n      );\n    }\n  };\n}\n\n/**\n * Injects a script tag onto the page\n * @param  {String} creativeSource is the URL for the script you want to append\n *                                 to the page.\n */\nexport function injectScriptFactory (creativeSource) {\n  var creativeTag = document.createElement('script');\n  creativeTag.type = 'text/javascript';\n  creativeTag.src = creativeSource;\n  creativeTag.async = 'async';\n  document.body.appendChild(creativeTag);\n}\n\n/**\n * Takes a config object and vaildates it\n * @param  {Object} config is the user defined config object\n * @return {Object}        the vaildated object\n */\nexport function vaildateConfig (config = {}) {\n  if (typeof config.instID === 'undefined' || config.instID === '') {\n    throw invaildeConfig('Missing \"instID\" in config');\n  }\n\n  if (typeof config.endpoint === 'undefined' || config.endpoint === '') {\n    config.endpoint = `https://ads-staging.fresh8.co/${config.instID}/raw`;\n  }\n\n  if (typeof config.inApp === 'undefined') {\n    config.inApp = false;\n  }\n\n  if (typeof config.shouldBreakOut === 'undefined') {\n    config.shouldBreakOut = false;\n  }\n\n  if (typeof config.listenOnPushState === 'undefined') {\n    config.listenOnPushState = false;\n  }\n\n  return config;\n}\n","import { getRef } from '../util';\nimport { invaildeConfig } from '../errors';\n\n/**\n * Makes a request to the ad server API building the URL from the config params\n * passed in.\n * @param  {Object} config is the configurations used to make the API reqeuest\n *                         E.G.\n *                         { slotID: 'f8-001'\n *                         , view: 'home-page' - optional\n *                         , clickTrackingRedirect: 'http://dfp.com?r=' - optional\n *                         , sport: 'football' - optional\n *                         , match: - optional\n *                         , competitorIDs: ['55436'] - optional Opta ID's\n *                         , competitors: ['Manchester United', 'Southampton'] - optinal\n *                         , competitionIDs: ['1245'] - optional Opta ID's\n *                         , competitions: ['Premier League'] - optional\n *                         , window: the window used to extra the page ref from\n *                         , inApp: false - optional\n *                         , endpoint: '' - optional\n *                         , linkSameWindow: true - optional\n *                         , brand: 'my-brand-name' - optional\n *                         , url: 'http://fresh8gaming.com' - optional\n *                         }\n * @return {Promise}\n */\nexport function requestAdData (config) {\n  const vaildatedConfig = vaildateRequestAdConf(config);\n  // Build the end point URL with the slot ID\n  const endpoint = constructRequestURL(vaildatedConfig.endpoint, {\n    slot: vaildatedConfig.slotID,\n    view: vaildatedConfig.view,\n    clickUrl: vaildatedConfig.clickTrackingRedirect,\n    sport: vaildatedConfig.sport,\n    match: vaildatedConfig.match,\n    competitorIds: vaildatedConfig.competitorIDs,\n    competitors: vaildatedConfig.competitors,\n    competitionIds: vaildatedConfig.competitionIDs,\n    competitions: vaildatedConfig.competitions,\n    linkSameWindow: vaildatedConfig.linkSameWindow,\n    brand: vaildatedConfig.brand,\n    ref: getRef(\n      vaildatedConfig.window,\n      vaildatedConfig.inApp,\n      vaildatedConfig.url\n    )\n  });\n  return fetch(endpoint, { credentials: 'include' })\n    .then(checkStatusCode)\n    .then(parseJSON);\n}\n\n/**\n * Checks the stats code on a response and rejects the promise chain if\n * less than 200 or greater than 300.\n * @param  {Object} response is the fetch response object\n * @return {(Promise.reject|Object)} a rejected promise or the reponse object\n */\nexport function checkStatusCode (response) {\n  if (response.status >= 200 && response.status < 300) {\n    return response;\n  }\n\n  return Promise.reject('Server returned error: ' + response.status);\n}\n\n/**\n * Returns the json from a fetch request\n * @param  {Object} response is the fetch response object\n * @return {Object} the parsed JSON object\n */\nexport function parseJSON (response) {\n  if (response) {\n    return response.json();\n  }\n}\n\n/**\n * Builds the request URL from the config with the option to add extra\n * key/value.\n * @param  {Object} options is used for adding extra key values to the URL\n *                          as a query strings.\n * @return {String}         The constructed URL\n */\nexport function constructRequestURL (url, options = {}) {\n  const queryStringsOptions = Object.assign({}, options);\n\n  if (typeof queryStringsOptions.competitorIds !== 'undefined') {\n    queryStringsOptions.competitorIds = queryStringsOptions.competitorIds.map(\n      value => encodeURIComponent(value)\n    );\n  }\n\n  if (typeof queryStringsOptions.competitors !== 'undefined') {\n    queryStringsOptions.competitors = queryStringsOptions.competitors.map(\n      value => encodeURIComponent(value)\n    );\n  }\n\n  if (typeof queryStringsOptions.competitionIds !== 'undefined') {\n    queryStringsOptions.competitionIds = queryStringsOptions.competitionIds.map(\n      value => encodeURIComponent(value)\n    );\n  }\n\n  if (typeof queryStringsOptions.competitions !== 'undefined') {\n    queryStringsOptions.competitions = queryStringsOptions.competitions.map(\n      value => encodeURIComponent(value)\n    );\n  }\n\n  const queryString = buildQueryString(queryStringsOptions);\n  return url + queryString;\n}\n\n/**\n * Takes a requestAd conf object and vaildates it\n * @param  {Object} config is the user defined config object\n * @return {Object}        the vaildated object\n */\nexport function vaildateRequestAdConf (config = {}) {\n  if (typeof config.endpoint === 'undefined' || config.endpoint === '') {\n    throw invaildeConfig('Missing \"endpoint\"');\n  }\n\n  if (typeof config.slotID === 'undefined' || config.slotID === '') {\n    throw invaildeConfig('Missing \"slotID\"');\n  }\n\n  if (typeof config.window === 'undefined' || config.window === '') {\n    throw invaildeConfig('Missing \"window\"');\n  }\n\n  if (typeof config.inApp === 'undefined') {\n    config.inApp = false;\n  }\n\n  if (typeof config.shouldBreakOut === 'undefined') {\n    config.shouldBreakOut = false;\n  }\n\n  if (typeof config.linkSameWindow === 'undefined') {\n    config.linkSameWindow = false;\n  }\n\n  if (typeof config.competitorIDs === 'undefined') {\n    config.competitorIDs = [];\n  }\n\n  if (typeof config.competitors === 'undefined') {\n    config.competitors = [];\n  }\n\n  if (typeof config.competitionIDs === 'undefined') {\n    config.competitionIDs = [];\n  }\n\n  if (typeof config.competitions === 'undefined') {\n    config.competitions = [];\n  }\n\n  if (typeof config.listenOnPushState === 'undefined') {\n    config.listenOnPushState = false;\n  }\n\n  if (\n    (config.competitors.length !== 0 || config.competitions.length !== 0) &&\n    !config.sport\n  ) {\n    throw invaildeConfig(\n      'Sport is required if \"competitions\" or \"competitors\" is passed through in the config'\n    );\n  }\n\n  return config;\n}\n\n/**\n * Takes a dictionary and converts it to a queryString\n * @param  {Object} dictionary is a dictionary of string key's to\n *                             string values.\n * @return {String} a queryString in the form of `?key=val&keyTwo=valTwo`.\n */\nexport function buildQueryString (options) {\n  var queryString = '?';\n  Object.keys(options).forEach(function (option) {\n    var value = options[option];\n    if (value && value !== '' && value.length !== 0) {\n      if (Object.prototype.toString.call(value) === '[object Array]') {\n        queryString += option + '=' + value.join(',') + '&';\n      } else {\n        queryString += option + '=' + value + '&';\n      }\n    }\n  });\n\n  return queryString;\n}\n","import { requestAdData } from '../api/index';\nimport { injectScriptFactory } from '../util';\nimport { invaildeConfig } from '../errors';\n\nexport default class Ad {\n  /**\n   * A class for managing and loading a single ad\n   * @param {Object} config is the configurations used to make the API reqeuest\n   *                        { slotID: 'f8-001'\n   *                        , creativeFactoryCache: new Cache() - used for\n   *                          global cache factory look ups\n   *                       , view: 'home-page' - optional\n   *                       , clickTrackingRedirect: 'http://dfp.com?r=' - optional\n   *                       , sport: 'football' - optional\n   *                       , matchID: '85623' - optional Opta ID\n   *                       , competitorIDs: ['55436'] - optional Opta ID's\n   *                       , competitors: ['Manchester United', 'Southampton'] - optinal\n   *                       , competitionIDs: ['1245'] - optional Opta ID's\n   *                       , competitions: ['Premier League'] - optional\n   *                       , window: the window used to extra the page ref from\n   *                       , inApp: false - optional\n   *                       , endpoint: '' - optional\n   *                       , appendPoint: 'body' - required\n   *                       , linkSameWindow: true - optional\n   *                       , brand: 'my-brand-name' - optional\n   *                       , url: 'http://fresh8gaming.com' - optional\n   *                       }\n   */\n  constructor (config = {}) {\n    // Use to indercate if the ad has been distroyed.\n    this.active = false;\n    // awaitingFactory is used when slecting what ad classes require an creative\n    // factory.\n    this.awaitingFactory = true;\n    // selector is use for selecting the ad in the DOM and is set by the \"load\"\n    // method.\n    this.selector = null;\n    // creativeRef this the creative type. Set by the \"load\" method and updated\n    // by the \"_reload\" method.\n    this.creativeRef = null;\n    // creativePath is the path to the js file needed to load the ad. Set by the\n    // \"load\" method and updated by the \"_reload\" method.\n    this.creativePath = null;\n    // CSSPath is the path to the CSS file needed to load the brand. Set by the\n    // \"load\" method and updated by the \"_reload\" method.\n    this.CSSPath = null;\n    // data is the payload data for the ad factory. Set by the \"load\" method\n    // and updated by the \"_reload\" method.\n    this.data = null;\n    // env is the payload data for the ad factory. Set by the \"load\" method and\n    // updated by the \"_reload\" method.\n    this.env = null;\n    // loadResolvers env data for the ad factory. Set by the \"load\" method and\n    // updated by the \"_reload\" method.\n    this.loadResolvers = null;\n    // adInstance is a refernce to the ad instance loaded by the creative factory.\n    // Set by the \"load\" method and updated by the \"_reload\" method.\n    this.adInstance = null;\n    // config for the ad class.\n    this.config = vaildateConfig(config);\n    // creativeFactoryCache is the global cache for the creative factories.\n    this.creativeFactoryCache = config.creativeFactoryCache;\n    // window is a refernce to the window object used when make API requests.\n    this.window = config.window;\n    // is it an evo product (default to false)\n    this.evo = false;\n  }\n\n  /**\n   * Fetches the data for the ad and loads the ad on the page while updating a\n   * lot the ad's state.\n   * @return {Promise} Resolve when the ad finishes loading and returns an\n   *                   instance of the ad class.\n   */\n  load () {\n    return new Promise((resolve, reject) => {\n      // Construct the object for the request data\n      const requestConfig = {\n        slotID: this.config.slotID,\n        view: this.config.view,\n        clickTrackingRedirect: this.config.clickTrackingRedirect,\n        sport: this.config.sport,\n        match: this.config.match,\n        competitorIDs: this.config.competitorIDs,\n        competitors: this.config.competitors,\n        competitionIDs: this.config.competitionIDs,\n        competitions: this.config.competitions,\n        window: this.config.window,\n        inApp: this.config.inApp,\n        endpoint: this.config.endpoint,\n        appendPoint: this.config.appendPoint,\n        linkSameWindow: this.config.linkSameWindow,\n        url: this.config.url,\n        brand: this.config.brand\n      };\n      // Make the API request to the ad server\n      requestAdData(requestConfig)\n        .then(payload => {\n          const resolvers = {\n            resolve,\n            reject\n          };\n          // Save the promise so it can be revoled after the creative script\n          // has loaded.\n          this.loadResolvers = resolvers;\n          // if env exists assume it\n          // Inject the scripts for each ad.\n          if (payload.env) {\n            this.evo = true;\n          }\n          if (this.evo) {\n            Object.keys(payload.products).forEach(product => {\n              this.creativeRef = payload.products[product].config;\n              this.CSSPath = payload.products[product].skin;\n                // this.CSSPath = `${payload.env.cdn}/${\n                //   payload.products[product].skin\n                // }.json`;\n              this.data = payload.products[product].instances[0];\n              this.env = payload.env;\n              this.creativePath = `${payload.env.cdn}/${\n                  payload.products[product].config\n                  }.js?v=${payload.env.version}`;\n              this.data.appendPoint = this.config.appendPoint;\n            });\n          } else {\n            Object.keys(payload).forEach(creativeRef => {\n              this.creativeRef = creativeRef;\n              this.CSSPath = payload[creativeRef].CSSPath;\n              this.data = payload[creativeRef].instances[0].data;\n              this.env = payload[creativeRef].instances[0].env;\n              this.creativePath = payload[creativeRef].creativePath;\n              this.data.appendPoint = this.config.appendPoint;\n            });\n          }\n\n          // If the ad is adhesion then it wont use the normal append point\n          // container selector.\n          if (this.env.adhesion) {\n            this.selector = '#f8-adhesion';\n          } else {\n            this.selector = `${this.config.appendPoint} .f8${this.creativeRef}`;\n          }\n          // Pass the data directly to the ad if we already have it's factory\n          // cached.\n          if (!this.awaitingFactory) {\n            this._callCreativeFactory();\n            // Else just script for the ad factory and pass the data too it once\n            // the loaded event has been emited.\n          } else {\n            // Inject the ad factory script and wait for the load event\n            injectScriptFactory(this.creativePath);\n          }\n        })\n\n        .catch(reason => {\n          this.active = false;\n          reject(reason);\n        });\n    });\n  }\n\n  /**\n   * Reloads first destroys the current ad in place then requests new data\n   * from the ad serving API, if the creative ref exists in the factory cache\n   * then it's loaded. If not a new script is injected into the page and once\n   * loaded will be called by the ad.\n   * @return {Promise} Resolve when the ad finishes loading\n   */\n  reload () {\n    return new Promise((resolve, reject) => {\n      const requestConfig = {\n        slotID: this.config.slotID,\n        view: this.config.view,\n        clickTrackingRedirect: this.config.clickTrackingRedirect,\n        sport: this.config.sport,\n        match: this.config.match,\n        competitorIDs: this.config.competitorIDs,\n        competitors: this.config.competitors,\n        competitionIDs: this.config.competitionIDs,\n        competitions: this.config.competitions,\n        window: this.config.window,\n        inApp: this.config.inApp,\n        endpoint: this.config.endpoint,\n        appendPoint: this.config.appendPoint,\n        linkSameWindow: this.config.linkSameWindow,\n        url: this.config.url,\n        brand: this.config.brand\n      };\n\n      // Request the ad data\n      return requestAdData(requestConfig)\n        .then(payload => {\n          // Grab the creative ref from the playload\n          let creativeRef;\n          if (this.evo) {\n            creativeRef = payload.products[0].config;\n          } else {\n            creativeRef = Object.keys(payload)[0];\n          }\n          const resolvers = {\n            resolve,\n            reject\n          };\n\n          // Save the promises incase they need to be resolved by the inject\n          // script.\n          this.loadResolvers = resolvers;\n          // Distroy the current ad in place.\n          this.destroy();\n          // If the creative type has changed then switch the ad type and update\n          // the currently set creative ref/creative path in the class.\n          if (creativeRef !== this.creativeRef) {\n            this.creativeRef = creativeRef;\n            if (this.evo) {\n              this.creativePath = `${payload.env.cdn}/${\n                payload.products[0].config\n                }.js?v=${payload.env.version}`;\n            } else {\n              this.creativePath = payload[creativeRef].creativePath;\n            }\n            this._switchAdType();\n          }\n          if (this.evo) {\n            Object.keys(payload.products).forEach(product => {\n              this.CSSPath = payload.products[product].skin;\n              this.data = payload.products[product].instances[0];\n              this.env = payload.env;\n              this.data.appendPoint = this.config.appendPoint;\n            });\n          } else {\n            Object.keys(payload).forEach(creativeRef => {\n              this.CSSPath = payload[creativeRef].CSSPath;\n              this.data = payload[creativeRef].instances[0].data;\n              this.env = payload[creativeRef].instances[0].env;\n              this.data.appendPoint = this.config.appendPoint;\n            });\n          }\n\n          // Update the class selector based on the brand being used\n          this.selector = `${this.config.appendPoint} .f8${this.creativeRef}`;\n          // Finally call the creative factory to create the ad\n          return this._callCreativeFactory();\n        })\n        .catch(reject);\n    });\n  }\n\n  /**\n   * Removes the ad from the DOM and cleans up any brand scripts added.\n   * @return {Promise} Resolves when finished.\n   */\n  destroy () {\n    // Only distroy the ad if it's currently active\n    if (this.active) {\n      const appEl = document.querySelector(this.selector);\n      // Remove the ad and the brand CSS\n      this.adInstance.destroy();\n      if (!this.evo) appEl.parentNode.removeChild(appEl);\n      this.active = false;\n    }\n  }\n\n  /**\n   * Swtich ad type changes get the ad factory for the new creative if it exists\n   * in the cache, otherwise it will inject a new script for it and wait for it\n   * load.\n   */\n  _switchAdType () {\n    if (this.creativeFactoryCache.exists(this.creativeRef)) {\n      this._setCreativeFactory(this.creativeFactoryCache.get(this.creativeRef));\n    } else {\n      this.awaitingFactory = true;\n      injectScriptFactory(this.creativePath);\n    }\n  }\n\n  /**\n   * Takes a creative factory and sets it as the current one in the class and\n   * also sets the state to not be waiting for a creative factory.\n   * @param {Function} creativeFactory is the creative factory you want to set.\n   */\n  _setCreativeFactory (creativeFactory) {\n    this.awaitingFactory = false;\n    this.creativeFactory = creativeFactory;\n  }\n\n  /**\n   * Calls the currently set creative factory if it's not waiting for one.\n   * @return {Promise} Resolves after the creative has been loaded on to the\n   * page.\n   */\n  _callCreativeFactory () {\n    if (!this.awaitingFactory) {\n      return this.creativeFactory(\n        this.env,\n        this.data,\n        this.CSSPath,\n        this.window\n      )\n        .then(adInstance => {\n          this.adInstance = adInstance;\n          this.active = true;\n          this.loadResolvers.resolve(this);\n        })\n        .catch(this.loadResolvers.reject);\n    }\n\n    return Promise.resolve();\n  }\n}\n\n/**\n * Vaildates the config for the ad class.\n * @param  {Object} config is the configurations you want to vaildate.\n * @return {Object}        the vaildated config.\n */\nexport function vaildateConfig (config = {}) {\n  if (typeof config.endpoint === 'undefined' || config.endpoint === '') {\n    throw invaildeConfig('Missing \"endpoint\"');\n  }\n\n  if (\n    typeof config.creativeFactoryCache === 'undefined' ||\n    config.creativeFactoryCache === ''\n  ) {\n    throw invaildeConfig('Missing \"creativeFactoryCache\"');\n  }\n\n  if (typeof config.slotID === 'undefined' || config.slotID === '') {\n    throw invaildeConfig('Missing \"slotID\"');\n  }\n\n  if (typeof config.appendPoint === 'undefined' || config.appendPoint === '') {\n    throw invaildeConfig('Missing \"appendPoint\"');\n  }\n\n  if (typeof config.window === 'undefined' || config.window === '') {\n    throw invaildeConfig('Missing \"window\"');\n  }\n\n  if (typeof config.inApp === 'undefined') {\n    config.inApp = false;\n  }\n\n  if (typeof config.shouldBreakOut === 'undefined') {\n    config.shouldBreakOut = false;\n  }\n\n  if (typeof config.linkSameWindow === 'undefined') {\n    config.linkSameWindow = false;\n  }\n\n  if (typeof config.competitorIDs === 'undefined') {\n    config.competitorIDs = [];\n  }\n\n  if (typeof config.competitors === 'undefined') {\n    config.competitors = [];\n  }\n\n  if (typeof config.competitionIDs === 'undefined') {\n    config.competitionIDs = [];\n  }\n\n  if (typeof config.competitions === 'undefined') {\n    config.competitions = [];\n  }\n\n  if (typeof config.listenOnPushState === 'undefined') {\n    config.listenOnPushState = false;\n  }\n\n  if (\n    (config.competitors.length !== 0 || config.competitions.length !== 0) &&\n    !config.sport\n  ) {\n    throw invaildeConfig(\n      'Sport is required if \"competitions\" or \"competitors\" is passed through in the config'\n    );\n  }\n\n  return config;\n}\n","export default class Cache {\n  /**\n   * A basic cache store class\n   */\n  constructor () {\n    this.cache = {};\n  }\n\n /**\n  * Set a value against a key in the store.\n  * @param  {String} key   is the name that you want to store the data under.\n  * @param  {*}      value is the data to you want to store.\n  */\n  put (key, value) {\n    this.cache[key] = value;\n  }\n\n  /**\n   * Remove a key/value pair from the store.\n   * @param {String} key is the name of the key you want to remove.\n   */\n  remove (key) {\n    if (this.cache[key]) {\n      delete this.cache[key];\n    }\n  }\n\n  /**\n   * Retrieve a value from the store using a key.\n   * @param  {String} key is the key you want to use to select cache value in\n   *                      the store.\n   * @return {*}          A cached value from the store if it exists.\n   */\n  get (key) {\n    return this.cache[key];\n  }\n\n  /**\n   * Checks if a value exists in the store.\n   * @param  {String} key is the key you want to use to check a value exists for.\n   * @return {Boolean}    whether the value exists or not.\n   */\n  exists (key) {\n    if (this.cache[key]) {\n      return true;\n    } else {\n      return false;\n    }\n  }\n}\n","/**\n * Adds customEvent method to the window if it doesn't already exist.\n */\nexport function customEvent () {\n  if (typeof window.CustomEvent === 'function') {\n    return false;\n  }\n\n  function CustomEvent (event, params) {\n    params = params || { bubbles: false, cancelable: false, detail: undefined };\n    var evt = document.createEvent('CustomEvent');\n    evt.initCustomEvent(event, params.bubbles, params.cancelable, params.detail);\n    return evt;\n  }\n\n  CustomEvent.prototype = window.Event.prototype;\n\n  window.CustomEvent = CustomEvent;\n}\n\n/**\n * Monkey patches the pushState function to emit a custome event\n * \"__f8-history-push-state\" on call.\n * @return {Object} Factories to apply and revert the polyfill changes\n */\nexport function PolyfillHistoryPushState () {\n  const _historyPushState = window.history.pushState;\n  const historyPushStateEvent = new CustomEvent('__f8-history-push-state');\n\n  /**\n   * Restores the original \"window.history.pushState\" method\n   */\n  function restore () {\n    window.history.pushState = _historyPushState;\n  }\n\n  /**\n   * Applies the event dispatcher to the \"history.pushState\" method\n   */\n  function fill () {\n    history.pushState = addEventDispatch;\n  }\n\n  /**\n   * A polyfilled version of the history.pushState\" method with the\n   * \"__f8-history-push-state\" dispatched on call.\n   */\n  function addEventDispatch () {\n    const historyPushState = _historyPushState.apply(this, arguments);\n    window.dispatchEvent(historyPushStateEvent);\n    return historyPushState;\n  }\n\n  return {\n    restore,\n    fill\n  };\n}\n","import 'whatwg-fetch';\nimport Ad from './ad/index';\nimport Cache from './cache/index';\n\nimport { customEvent, PolyfillHistoryPushState } from './polyfill';\n\nimport { getWindow, bindf8ToWindow, vaildateConfig } from './util';\n\nconst version = '1.0.0';\n\nexport default class Fresh8 {\n  /**\n   * Fresh8 is a class that handles the injection of Fresh8 ads into a target\n   * based on slot ID.\n   * @param {Object} config is the global instance configurations E.G.\n   *                        { instID: '54ad56a213fe19232b646047'\n   *                        , shouldBreakOut: false  - optinal\n   *                        , listenOnPushState: false - optinal\n   *                        , inApp: false - optional\n   *                        , endpoint: '' - optional\n   *                        }\n   *                        For more details on these options please refer to\n   *                        the readme.\n   */\n  constructor (config) {\n    // Ad class\n    this.Ad = Ad;\n    // Adds polyfills for custome events.\n    customEvent();\n    // The vaildated user config.\n    this.config = vaildateConfig(config);\n    // The window that should be used to append the ad to.\n    this.window = getWindow(this.config.shouldBreakOut);\n    // A store for the currently loaded ads.\n    this.ads = [];\n    // Cache for the creative factories.\n    this.creativeFactoryCache = new Cache();\n    // Bind the \"__f8\" object to the current window. This is rquired by our ad\n    // factories.\n    bindf8ToWindow(version, this.window);\n    // Bind the global event listener that's fired when the ad factory is loaded.\n    this._addEventLisnters();\n    // Bind a custome event for push state changes.\n    if (this.config.listenOnPushState) {\n      this.polyfillHistoryPushState = new PolyfillHistoryPushState();\n      this.polyfillHistoryPushState.fill();\n    }\n  }\n\n  /**\n   * Request an ad by slot ID, this ad will be appended to the \"appendPoint\"\n   * @param  {Object} config defines want data you want to pass to the Fresh8\n   *                         ad system when injecting your ad. E.G.\n   *                         { slotID: 'f8-001' - required\n   *                         , url: 'http://fresh8gaming.com'\n   *                         , appendPoint: 'body' - required\n   *                         , view: 'home-page' - optional\n   *                         , clickTrackingRedirect: 'http://dfp.com?r='  - optional\n   *                         , sport: 'football' - optional\n   *                         , matchID: '85623' - optional Opta ID\n   *                         , competitorIDs: ['55436'] - optional Opta ID's\n   *                         , competitors: ['Manchester United', 'Southampton'] - optinal\n   *                         , competitionIDs: ['1245'] - optional Opta ID's\n   *                         , competitions: ['Premier League'] - optional\n   *                         , brand: 'my-brand-name' - optional\n   *                         }\n   *                         For more details on these options please refer to\n   *                         the readme.\n   * @return {Promise}       This is resolved or rejected based on if the ad\n   *                         loaded successfully or not.\n   */\n  requestAd (config = {}) {\n    return new Promise(resolve => {\n      // Add Fresh8 class data to request ad config\n      config.endpoint = this.config.endpoint;\n      config.window = this.window;\n      config.creativeFactoryCache = this.creativeFactoryCache;\n      // Create a new ad and\n      const ad = new this.Ad(config);\n\n      // Store the ad for reference\n      this.ads.push(ad);\n      // Load the ad a return the promise\n      return resolve(ad.load());\n    });\n  }\n\n  /**\n   * Cleans up any event lisnters/ads added by the class\n   */\n  remove () {\n    // Remove any added event lisnters\n    this._removeEventLisnters();\n    // Remove all the ads from the page\n    this.destroyAllAds();\n    // Restore the patch history push state\n    if (this.config.listenOnPushState) {\n      this.polyfillHistoryPushState.restore();\n    }\n  }\n\n  /**\n   * Reloads all the currently active ads on the page\n   * @return {Promise} containing references to the new ads\n   */\n  reloadAllAds () {\n    const activeAds = this.ads.filter(ad => ad.active);\n    return Promise.all(activeAds.map(ad => ad.reload()));\n  }\n\n  /**\n   * Destroys all currently active ads on the page\n   * @return {Promise} resolves on completion\n   */\n  destroyAllAds () {\n    const activeAds = this.ads.filter(ad => ad.active);\n    return Promise.all(activeAds.map(ad => ad.destroy()));\n  }\n\n  /**\n   * Adds the \"__f8-creative-script-loaded\" and \"__f8-history-push-state\" event\n   * lisnters to the window\n   */\n  _addEventLisnters () {\n    this.boundOnCreativeLoaded = this._onCreativeLoaded.bind(this);\n    this.boundOnHistoryPushStateChange = this._onHistoryPushStateChange.bind(\n      this\n    );\n    this.window.addEventListener(\n      '__f8-creative-script-loaded',\n      this.boundOnCreativeLoaded\n    );\n    this.window.addEventListener(\n      '__f8-product-script-loaded',\n      this.boundOnCreativeLoaded\n    );\n    this.window.addEventListener(\n      '__f8-history-push-state',\n      this.boundOnHistoryPushStateChange\n    );\n  }\n\n  /**\n   * Removes the \"__f8-creative-script-loaded\" and \"__f8-history-push-state\" event\n   * lisnters from the window\n   */\n  _removeEventLisnters () {\n    this.window.removeEventListener(\n      '__f8-creative-script-loaded',\n      this.boundOnCreativeLoaded\n    );\n    this.window.removeEventListener(\n      '__f8-product-script-loaded',\n      this.boundOnCreativeLoaded\n    );\n    this.window.removeEventListener(\n      '__f8-history-push-state',\n      this.boundOnHistoryPushStateChange\n    );\n  }\n\n  /**\n   * Handler for the script loaded event and set the creative factory on any\n   * ads that match the creative ref and are waiting for a creativeFactory.\n   * @param {Object} event is a custom event object\n   */\n  _onCreativeLoaded (event) {\n    // Cache the creative factory so we can re used it for other ads\n    this.creativeFactoryCache.put(event.creativeRef, event.creativeFactory);\n    // Loop over the ads and check if any that require a creative factory\n    // with the matching creative ref\n    this.ads.forEach(ad => {\n      if (ad.evo) {\n        if (ad.awaitingFactory && event.config === ad.creativeRef) {\n          // Set the creative factory\n          ad._setCreativeFactory(event.productFactory);\n          // Call the creative factory loading the ad onto the page\n          ad._callCreativeFactory();\n        }\n      } else {\n        if (ad.awaitingFactory && event.creativeRef === ad.creativeRef) {\n          // Set the creative factory\n          ad._setCreativeFactory(event.creativeFactory);\n          // Call the creative factory loading the ad onto the page\n          ad._callCreativeFactory();\n        }\n      }\n    });\n  }\n\n  /**\n   * Handels the push state change event that reloads all the currently active\n   * ads on the page\n   */\n  _onHistoryPushStateChange () {\n    this.reloadAllAds().catch();\n  }\n}\n","import Fresh8 from './index';\n\n// Check if the \"Fresh8\" object has already been bound to the window.\nif (!window.Fresh8) {\n  window.Fresh8 = Fresh8;\n}\n"],"names":["support","self","Symbol","Blob","e","viewClasses","isArrayBufferView","ArrayBuffer","isView","obj","indexOf","Object","prototype","toString","call","normalizeName","name","String","test","TypeError","toLowerCase","normalizeValue","value","iteratorFor","items","iterator","next","shift","done","undefined","Headers","headers","this","map","forEach","append","Array","isArray","header","getOwnPropertyNames","consumed","body","bodyUsed","Promise","reject","fileReaderReady","reader","resolve","onload","result","onerror","error","readBlobAsArrayBuffer","blob","FileReader","promise","readAsArrayBuffer","bufferClone","buf","slice","view","Uint8Array","byteLength","set","buffer","Body","_initBody","_bodyInit","_bodyText","isPrototypeOf","_bodyBlob","FormData","_bodyFormData","URLSearchParams","DataView","_bodyArrayBuffer","get","type","rejected","Error","arrayBuffer","then","text","readAsText","chars","length","i","fromCharCode","join","readArrayBufferAsText","formData","decode","json","JSON","parse","oldValue","has","hasOwnProperty","callback","thisArg","keys","push","values","entries","methods","Request","input","options","method","upcased","url","credentials","mode","signal","toUpperCase","referrer","form","trim","split","bytes","replace","decodeURIComponent","Response","bodyInit","status","ok","statusText","clone","response","redirectStatuses","redirect","RangeError","location","DOMException","err","message","stack","create","constructor","fetch","init","request","aborted","xhr","XMLHttpRequest","abortXhr","abort","rawHeaders","getAllResponseHeaders","line","parts","key","responseURL","responseText","ontimeout","onabort","open","withCredentials","responseType","setRequestHeader","addEventListener","onreadystatechange","readyState","removeEventListener","send","invaildeConfig","const","injectScriptFactory","creativeSource","creativeTag","document","createElement","src","async","appendChild","requestAdData","config","vaildatedConfig","endpoint","slotID","window","inApp","shouldBreakOut","linkSameWindow","competitorIDs","competitors","competitionIDs","competitions","listenOnPushState","sport","vaildateRequestAdConf","queryStringsOptions","assign","competitorIds","encodeURIComponent","competitionIds","queryString","option","constructRequestURL","slot","clickUrl","clickTrackingRedirect","match","brand","ref","userOverrideRef","links","getElementsByTagName","href","canonical","rel","getRef","checkStatusCode","parseJSON","polyfill","Ad","active","awaitingFactory","selector","creativeRef","creativePath","CSSPath","data","env","loadResolvers","adInstance","creativeFactoryCache","appendPoint","vaildateConfig","evo","load","payload","resolvers","products","product","skin","instances","this$1","adhesion","_callCreativeFactory","catch","reason","reload","destroy","_switchAdType","appEl","querySelector","parentNode","removeChild","exists","_setCreativeFactory","creativeFactory","Cache","cache","PolyfillHistoryPushState","_historyPushState","history","pushState","historyPushStateEvent","CustomEvent","addEventDispatch","historyPushState","apply","arguments","dispatchEvent","put","remove","Fresh8","version","targetWindow","event","params","bubbles","cancelable","detail","evt","createEvent","initCustomEvent","Event","customEvent","instID","shouldBreak","let","workingWindow","top","parent","getWindow","ads","__f8","setUndefinedProperty","val","_addEventLisnters","polyfillHistoryPushState","fill","requestAd","ad","_removeEventLisnters","destroyAllAds","restore","reloadAllAds","activeAds","filter","all","boundOnCreativeLoaded","_onCreativeLoaded","bind","boundOnHistoryPushStateChange","_onHistoryPushStateChange","productFactory"],"mappings":"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"}